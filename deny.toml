# Project policies.
#
# These policies can be enforced using `cargo deny check`.

[advisories]
ignore = [
    # utoipa-axum -> paste is unmaintained but there's no safe upgrade yet.
    # https://rustsec.org/advisories/RUSTSEC-2024-0436
    "RUSTSEC-2024-0436",
]

[licenses]
# Allow common non-restrictive licenses. ISC is used for various DNS and crypto
# things, and it's a minimally restrictive open source license.
# Licenses not in this list will be denied (including copyleft and AGPL).
allow = ["MIT", "Apache-2.0", "BSD-3-Clause", "BSD-2-Clause", "ISC", "Zlib", "Unicode-3.0"]

[[licenses.clarify]]
# Ring has a messy license.
name = "ring"
expression = "ISC AND OpenSSL AND MIT"
license-files = [
    { path = "LICENSE", hash = 3171872035 },
]

[bans]
# Warn about multiple versions of the same crate, unless we've indicated otherwise below.
multiple-versions = "warn"

deny = [
    # OpenSSL has caused endless deployment and build problems. We use rustls
    # for TLS everywhere, and diesel-async with tokio-postgres (pure Rust) for
    # database connections.
    { name = "openssl" },
    { name = "openssl-sys" },
]

skip = [
    # handlebars -> derive_builder uses darling 0.20, diesel uses 0.21
    { name = "darling", version = "0.20" },
    { name = "darling_core", version = "0.20" },
    { name = "darling_macro", version = "0.20" },

    # prettytable-rs -> dirs-next -> redox_users uses thiserror 1.x
    { name = "thiserror", version = "1" },
    { name = "thiserror-impl", version = "1" },
]

skip-tree = [
    # Build-only dependency uses some stale crates.
    { name = "pest_meta" },
    # We're never running on top of a real WASI platform, so just ignore it.
    { name = "wasi" },
    # ring and prettytable-rs pull in older getrandom via redox_users
    { name = "getrandom", version = "0.2" },
    # ring uses windows-sys 0.52; socket2 uses 0.60; affects Windows only
    { name = "windows-sys", version = "0.52" },
    { name = "windows-sys", version = "0.60" },
]

